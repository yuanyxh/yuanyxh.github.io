---
title: 深入浅出 Vue.js
date: 2024-07-21 17:19:00
author: yuanyxh
imageUrl: https://qkc148.bvimg.com/18470/781577c47866d14c.png
description: 《深入浅出 Vue.js》 是 360 工程师刘博文编写的一本深入介绍 Vue.js 2.0 的一本编程书籍，通过讲解源码的方式带我们了解 Vue.js 2.0 的工作方式，更好的帮助我们理解 Vue 是如何运作的。
book: true
---

<Header frontmatter={frontmatter} />

<Toc toc={toc} />

## 简介

《深入浅出 Vue.js》 是 360 工程师刘博文编写的一本深入介绍 Vue.js 2.0 的一本编程书籍，通过讲解源码的方式带我们了解 Vue.js 2.0 的工作方式，更好的帮助我们理解 Vue 是如何运作的。

## 章节

### 第 1 章 Vue.js 简介

介绍了 Vue 的发展历程，从 13 年的第一个 commit，更新到 Vue 1.0、Vue 2.0，始终坚持渐进式框架的核心理念，使它变得易用，上手简单。

### 第 2 章 Object 的变化侦测

介绍了响应式的核心，通过 Object.defineProperty 定义属性的 getter、setter 来处理数据的变化，在 getter 时收集依赖 Dep，在 setter 时触发依赖，还介绍了其中重要的 Watcher 和 Observer 角色。

这种方式有他的局限性，比如新增属性和删除属性是无法被侦测到的。

### 第 3 章 Array 的变化侦测

介绍了对于 Array 数据的变化侦测方案，因为 Array 有能够改变自身的方法，所以需要对这些方法进行代理，通过对这些方法进行重写来实现数据变化的侦测。

对于 Array 元素中的每个元素同样会进行侦测，使用递归进行。

### 第 4 章 变化侦测相关的 API 实现原理

介绍了 $watch、$set、$delete 三个 API 的实现方式，$watch 通过 Watcher 为基础实现，$set 将属性进行响应式的处理，$delete 在内部删除数据后手动触发更新。

### 第 5 章 虚拟 DOM 简介

介绍了虚拟 DOM，是将状态映射成视图的一种方案，是对真实 DOM 的一种映射，引入虚拟 DOM 可以减少对真实 DOM 的操作；同时说明了 Vue 2.0 中的响应式更新粒度是中等较细的，Vue 可以感知到组件粒度的数据变化，然后通过新旧两个虚拟 DOM 的对比可以找到变化的部分。

### 第 6 章 VNode

介绍了 VNode，VNode 本质是一个 js 对象，将这些 VNode 对象和原生 HTML 元素和组件进行映射，作为虚拟 DOM 树中的节点，以此来实现高效的更新操作。

### 第 7 章 patch

介绍了 patch，patch 是通过对比新旧虚拟 DOM 中的 VNode 节点，通过修补不同的节点来更新真实 DOM 的一种方式，将对操作 DOM 的消耗转变为 js 计算消耗来提升应用的性能。

patch 有三种原子操作：新增、删除、更新。通过对虚拟 DOM 的递归对比来完成。

### 第 8 章 模版编译

介绍了模版编译内容，在 vue 中我们可以通过模版的方式声明使的编写动态内容，vue 内部会通过解析器、优化器、代码生成等步骤来生成模版对应的渲染函数。

解析器将模版字符串解析为 ast（抽象语法树），然后交由优化器标记静态内容，最后生成渲染函数。

渲染函数访问响应式变量，这会触发 Watcher 将渲染函数加入到依赖中，这样每次响应式变量更新时会重新触发渲染。渲染函数会生成 VNode。

### 第 9 章 解析器

介绍了解析器，解析器用于将模版字符串解析为 ast。解析器通过对不同的标识位进行截取来提取内容，如元素开始、元素结束、文本开始、文本结束，同时维护一个解析栈，通过这个栈维护关键信息。

栈顶的元素始终是当前解析内容的父元素，通过这种方式可以构建树结构的 ast。

解析器除了解析元素外，还需要解析元素属性、文本内存在的插值变量。

### 第 10 章 优化器

优化器的作用是递归遍历 ast 树，找到树中永远不会变化的节点并打上标记，vue 会忽略被打上静态标记的节点，以此来达到优化的目的。

### 第 11 章 代码生成器

代码生成器通过对 ast 树递归生成代码字符串的方式来生成渲染函数，代码字符串中，针对不同的节点类型调用不同的生成函数，如元素就调用 `createElement` 函数来生成元素类型的 VNode，在生成代码字符串时内部会通过 `with(this)` 来使作用域内部可以访问到响应式变量，最终完整的代码字符串会通过 `new Function` 来生成渲染函数。

### 第 12 章 架构设计与项目结构

介绍了 Vue.js 第项目组织方式，以及内部的架构，项目结构以分包、文件隔离的方式组织，如 observer、vdom；架构设计方面分为了核心部分、跨平台部分、公用辅助部分。

### 第 13 章 实例方法与全局 API 的实现原理

我们在使用 Vue 进行开发的时候经常会用到内部提供的 API，本章介绍了挂载在 Vue 原型上的状态修改接口、事件接口、声明周期接口，如 $set、$delete、$on、$off、$mount 等。

还介绍了存在于 Vue 身上的静态全家方法，如 Vue.component 用于注册全局组件、Vue.directive 用于注册全局指令。

额外介绍了事件循环相关知识。

### 第 14 章 生命周期

介绍了一个 Vue 实例的完整生命周期，共分为 4 个阶段：

1. 初始化阶段 - 初始化实例
2. 模版编译阶段 - 编译模版，如果存在
3. 挂载阶段 - 挂载实例到真实 DOM
4. 卸载阶段 - 清理数据，如事件。

这 4 个阶段可以被 8 个生命周期钩子概括：

1. beforeCreate
2. created
3. beforeMount
4. mounted
5. beforeUpdate
6. updated
7. beforeUnmount
8. unmounted

另外还有一个用于捕获错误的生命构子：errorCaputred。

### 第 15 章 指令的奥秘

介绍了 Vue 中的指令，指令的实现贯穿了 Vue 的完整流程，从编译时解析器解析出指令，到运行时指令的执行。

同时介绍了 v-if、v-for、v-on 等内置指令的实现，这些内置指令的实现不同于自定义指令，Vue 对于这类内置指令会在模版解析阶段就生成完整代码。

### 第 16 章 过滤器的奥秘

介绍了 Vue 中的过滤器，过滤器允许我们定义一个或多个过滤函数，用于将字符串格式化。

### 第 17 章 最佳实践

本章是本书的最后一章，为我们推荐了很多作者总结的有关于 Vue 项目开发的最佳实践，包括但不限于：

- 为列表渲染设置 key
- 在 v-if/v-if-else/v-else 中设置 key
- 为所有路由添加 query
- 区别 Vuex 和 props 的使用边界
- 避免 v-if/v-for 混用
- 为单文件组件的样式设置作用域
- 避免隐形的父子通信

还有一些关于风格规范的推荐：

- 单文件组件的命名方式
- 自闭合组件
- props 名的大小写
- 简单的计算属性
- 指令缩写
- 良好的代码排序
